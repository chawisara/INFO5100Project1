<html>

<head>
<title>Project 1 - INFO 5100 - Data-driven Web Pages</title>
<style>
	body {font-family: 'Alegreya Sans', Calibri, sans-serif; }
	svg {border: solid #cc 1px; }
	path.country { fill: #ccc; stroke: #888;; }
</style>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="http://d3js.org/topojson.v2.min.js"></script>
<script src="https://d3js.org/d3-array.v1.min.js"></script>
<script src="https://d3js.org/d3-geo.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v1.min.js"></script>
</head>

<body>
	<h1 style="text-align: center; padding-top: 20px; color: #778899;">Extinct and Endangered Languages Around the World</h1>
	<p style="text-align: center;"> Group members: Ming Cheng, Yue Xu, Chawisara Uswachoke </p>
	<p>
		<svg id="timeline" height="400" width="1200"></svg>
		<script>

		var svg = d3.select("#timeline");
		var data;

		var parseRow = function(line) {
		
			return{
				Language: line["Name in English"], //name of the language
			    Year: line["Year of Extinction"],
			    Frequency: line["Frequency"],
			    Country: line["Countries"],
			}
		};

		d3.queue()
		.defer(d3.csv, "extinction-timeline.csv", parseRow)
		.await(function(error, extinctionData){
			data=extinctionData;
			showTimeline(data);
		});

		var parseTime = d3.timeParse("%Y");

		function showTimeline(data){
			var yearExtent = d3.extent(data, function (d) { if(d.Country=="United States of America") return parseTime(d.Year); });
			var timeScale = d3.scaleTime().domain(yearExtent).range([10, 1190]);
			var timeAxis = d3.axisBottom(timeScale);

			svg.append("g").attr("transform","translate(0,200)").call(timeAxis);

			var side=true;
			var i=190;
			var prevYear;
			var y=183;

			data.forEach(function (d) {
				if(d.Country=="United States of America"){
					console.log(d.Country);
					if(prevYear<=d.Year+5 && prevYear>=d.Year-5){
						if(side){
							i-=10;
							y-=8;
							side=false;
						}else{
							i+=60;
							y+=50;
							side=true;
						}
						
					}else{
						i=190;
						y=192;
						prevYear=d.Year;
					}

					if(d.Language=="Eyak"){
						svg.append("text")
						.attr("x", timeScale(parseTime(d.Year))-10)
						.attr("y", i)
						.style("font-family","Calibri")
						.style("font-size",12)
						.style("text-anchor","middle")
						.text(d.Language);

						svg.append("line")
						.attr("x1", timeScale(parseTime(d.Year)))
						.attr("y1", y)
						.attr("x2", timeScale(parseTime(d.Year)))
						.attr("y2", 200)
						.style("stroke","black")
						.style("stroke-width","1px")
						.style("opacity", 0.8);

					}else if(d.Language=="Cayuse" || d.Language=="Mattole"){

						svg.append("line")
						.attr("x1", timeScale(parseTime(d.Year))+8)
						.attr("y1", i)
						.attr("x2", timeScale(parseTime(d.Year)))
						.attr("y2", 200)
						.style("stroke","black")
						.style("stroke-width","1px")
						.style("opacity", 0.8);

						svg.append("text")
						.attr("x", timeScale(parseTime(d.Year))+10)
						.attr("y", i)
						.style("font-family","Calibri")
						.style("font-size",12)
						.style("text-anchor","middle")
						.text(d.Language);

					}else{

						svg.append("line")
						.attr("x1", timeScale(parseTime(d.Year)))
						.attr("y1", y)
						.attr("x2", timeScale(parseTime(d.Year)))
						.attr("y2", 200)
						.style("stroke","black")
						.style("stroke-width","1px")
						.style("opacity", 0.8);
						
						svg.append("text")
						.attr("x", timeScale(parseTime(d.Year)))
						.attr("y", i)
						.style("font-family","Calibri")
						.style("font-size",12)
						.style("text-anchor","middle")
						.text(d.Language);

					}
					
				}
			});
		}


		</script>
	</p>
</svg>
<P>Extinct Languages</P>
</body>

</html>