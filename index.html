<html>

<head>
<title>Project 1 - INFO 5100 - Data-driven Web Pages</title>
<style>
	body {font-family: 'Alegreya Sans', Calibri, sans-serif; }
	svg {border: solid #cc 1px; }
	path.country { fill: #ccc; stroke: #888;; }
</style>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="http://d3js.org/topojson.v2.min.js"></script>
<script src="https://d3js.org/d3-array.v1.min.js"></script>
<script src="https://d3js.org/d3-geo.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v1.min.js"></script>
</head>

<body>
	<p> Group members: Ming Cheng, Yue Xu, Chawisara Uswachoke </p>
	<p>Map<br>
		<svg id="map" height="600" width="1200"></svg>
		<script>
		var svg = d3.select("#map");

		var projection = d3.geoNaturalEarth();
		var mapData;
		var countries;
		var languageData;

		//applied to all rows, select 5 columns, change names, and convert strings to numbers. 
		var parseRow = function(line) {
		
			return{
				Language: line["Name in English"], //name of the language
				Latitude: Number(line["Latitude"]),
				Longitude: Number(line["Longitude"]),
				SpeakersNo: Number(line["Number of speakers"]),
				Degree: line["Degree of endangerment"],
			}
		};

		d3.queue()
		.defer(d3.json, "world-50m.json")
		.defer(d3.csv, "data.csv", parseRow)
		.await(function(error, worldMapData, rawLanguage){
			mapData = worldMapData;
			countries = topojson.feature(mapData, mapData.objects.countries);
			languageData=rawLanguage;
			showMap(languageData);

		});

		//create new set of coordinates for language locations
		var coordinates = function(data){
			var result = [];
			data.forEach(function(d){
				result.push([d.Longitude, d.Latitude]);
			});

			return result;
		}

		function showMap(languageData) {

			projection.fitExtent([[0,0], [svg.attr("width"), svg.attr("height")]], countries);
			pathGenerator = d3.geoPath().projection(projection);

			var paths=svg.selectAll("path.country").data(countries.features);
			paths.enter().append("path").attr("class","country")
			.attr("d", function(country){
				return pathGenerator(country);
			});

			var interestingPoints = coordinates(languageData);

			interestingPoints.forEach(function (points) {

				svg.append("circle")
				.attr("cx", projection(points)[0])
				.attr("cy", projection(points)[1])
				.attr("r", 3)
				.style("opacity", 0.5)
				.style("fill", "red");

			});


		}
		</script>
	</p>
</body>

</html>