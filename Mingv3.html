<html>

<head>
<title>Project 1 - INFO 5100 - Data-driven Web Pages</title>
<style>
	body {font-family: 'Alegreya Sans', Calibri, sans-serif; }
	svg {border: solid #ccc 1px; }
	path.country { fill: #ccc; stroke: #888;}
</style>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="http://d3js.org/topojson.v2.min.js"></script>
<script src="https://d3js.org/d3-array.v1.min.js"></script>
<script src="https://d3js.org/d3-geo.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v1.min.js"></script>
</head>

<body>
	<h1 style="text-align: center; padding-top: 20px; color: #778899;">Extinct and Endangered Languages Around the World</h1>
	<p style="text-align: center;"> Group members: Ming Cheng, Yue Xu, Chawisara Uswachoke </p>
	<p><br>
		<svg id="map" height="600" width="1200"></svg>
		<svg id="USmap" height="800" width="1200"></svg>
		<script>

		var svgWorldMap = d3.select("#map");
		var svgUSmap=d3.select("#USmap");

		var worldProjection = d3.geoNaturalEarth();
		var pathGenerator = d3.geoPath().projection(worldProjection);
		var mapData;
		var countries;
		var languageData;

		var USprojection = d3.geoAlbersUsa();
		var USpathGenerator = d3.geoPath().projection(USprojection);
		var states;

		//applied to all rows, select 5 columns, change names, and convert strings to numbers. 
		var parseRow = function(line) {
		
			return{
				Language: line["Name in English"], //name of the language
				Latitude: Number(line["Latitude"]),
				Longitude: Number(line["Longitude"]),
				SpeakersNo: Number(line["Number of speakers"]),
				Degree: line["Degree of endangerment"],
				Country: line["Countries"],
			}
		};

		d3.queue()
		.defer(d3.json, "world-50m.json")
		.defer(d3.csv, "data.csv", parseRow)
		.defer(d3.json, "us.json")
		.await(function(error, worldMapData, rawLanguage, USMapData){
			mapData = worldMapData;
			countries = topojson.feature(mapData, mapData.objects.countries);
			states=topojson.feature(USMapData, USMapData.objects.states);
			languageData=rawLanguage;
			showMap(languageData);
			showUSmap(languageData);
		});

		var colors=["#FFC300", "#FF5733", "#C70039", "#900C3F",  "#581845"];


		//create new set of coordinates for language locations + colors
		var dataPoints = function(data){
			var result = [];
			data.forEach(function(d){
				switch(d.Degree){
					case "Extinct":
						result.push([d.Longitude, d.Latitude, colors[0], d.Language]);
						break;
					case "Critically endangered":
						result.push([d.Longitude, d.Latitude, colors[1], d.Language]);
						break;
					case "Severely endangered":
						result.push([d.Longitude, d.Latitude, colors[2], d.Language]);
						break;
					case "Definitely endangered":
						result.push([d.Longitude, d.Latitude, colors[3], d.Language]);
						break;
					case "Vulnerable":
						result.push([d.Longitude, d.Latitude, colors[4], d.Language]);
						break;
				}
			});

			return result;
		}

		//create new set of coordinates for language locations + colors
		var USdataPoints = function(data){
			var result = [];
			data.forEach(function(d){

				if(d.Country == "United States of America"){
					var loc = [d.Longitude, d.Latitude];
					switch(d.Degree){
						case "Extinct":
							result.push([loc, colors[0], d.Language]);
							break;
						case "Critically endangered":
							result.push([loc, colors[1], d.Language]);
							break;
						case "Severely endangered":
							result.push([loc, colors[2], d.Language]);
							break;
						case "Definitely endangered":
							result.push([loc, colors[3], d.Language]);
							break;
						case "Vulnerable":
							result.push([loc, colors[4], d.Language]);
							break;
					}
				}
			});

			console.log(result);

			return result;
		}
		
		//Map for the world data
		function showMap(languageData) {

			worldProjection.fitExtent([[0,0], [svgWorldMap.attr("width"), svgWorldMap.attr("height")]], countries);

			var paths=svgWorldMap.selectAll("path.country").data(countries.features);
			paths.enter().append("path").attr("class","country")
			.attr("d", function(country){
				return pathGenerator(country);
			});

			var interestingPoints = dataPoints(languageData);

			interestingPoints.forEach(function (points) {

				svgWorldMap.append("circle")
				.attr("cx", worldProjection(points)[0])
				.attr("cy", worldProjection(points)[1])
				.attr("r", 3)
				.style("opacity", 0.5)
				.style("fill", points[2]);

				//Extinct languages
				svgWorldMap.append("circle")
				.attr("r", 5)
				.attr("cx", 25)
				.attr("cy", 430)
				.style("fill", "#FFC300");

				svgWorldMap.append("text")
				.attr("x", 35)
				.attr("y", 435)
				.text("Extinct Languages");

				//Critically Endangered Languages
				svgWorldMap.append("circle")
				.attr("r", 5)
				.attr("cx", 25)
				.attr("cy", 455)
				.style("fill", "#FF5733");

				svgWorldMap.append("text")
				.attr("x", 35)
				.attr("y", 460)
				.text("Critically Endangered Languages");

				//Severely Endangered Languages
				svgWorldMap.append("circle")
				.attr("r", 5)
				.attr("cx", 25)
				.attr("cy", 480)
				.style("fill", "#C70039");

				svgWorldMap.append("text")
				.attr("x", 35)
				.attr("y", 485)
				.text("Severely Endangered Languages");

				//Definitely Endangered Languages
				svgWorldMap.append("circle")
				.attr("r", 5)
				.attr("cx", 25)
				.attr("cy", 505)
				.style("fill", "#900C3F");

				svgWorldMap.append("text")
				.attr("x", 35)
				.attr("y", 510)
				.text("Definitely Endangered Languages");

				//Vulnerable languages
				svgWorldMap.append("circle")
				.attr("r", 5)
				.attr("cx", 25)
				.attr("cy", 530)
				.style("fill", "#581845");

				svgWorldMap.append("text")
				.attr("x", 35)
				.attr("y", 535)
				.text("Vulnerable Languages");
			});
		}


		//Map for US data only
		function showUSmap(languageData){
			USprojection.fitExtent([[0,0], [svgUSmap.attr("width"), svgUSmap.attr("height")]], states);

			var paths=svgUSmap.selectAll("path.country").data(states.features);
			paths.enter().append("path").attr("class","country")
			.merge(paths)
			.attr("d", function(country){
				return USpathGenerator(country);
			});

			var interestingPoints = USdataPoints(languageData);

			interestingPoints.forEach(function (points) {

				svgUSmap.append("circle")
				.attr("cx", USprojection(points[0])[0])
				.attr("cy", USprojection(points[0])[1])
				.attr("r", 3)
				.style("opacity", 0.6)
				.style("fill", points[1]);

				//plot text on the map
				svgUSmap.append("text")	
								.attr("x", USprojection(points[0])[0])
								.attr("y", USprojection(points[0])[1])
								.text(points[2])
								.attr("fill", points[1])
								.attr("font-size", "10pt")
								.style("text-anchor", "middle")
								.style("opacity", 0.5);
			});
		}


		</script>
	</p>
</svg>
<P>Extinct Languages</P>
</body>

</html>